{% extends 'app/base.html' %}

{% block head %}
    {{ block.super }}
    <script src="https://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

{% endblock %}

{% load static %}

{#内容开始        #}
{% block content %}

    <div class="page has-sidebar-left height-full">
        <header class="blue accent-3 relative nav-sticky">
            <div class="container-fluid text-white">
                <div class="row p-t-b-10 ">
                    <div class="col">
                        <h4><i class="icon icon-calendar"></i>牛皮网</h4>
                    </div>
                </div>
                <ul class="nav responsive-tab nav-material nav-material-white">
                    <li>
                        <a class="nav-link " href="{% url 'app:index' %}"><i class="icon icon-list"></i>首页</a>
                    </li>
                    <li>
                        <a class="nav-link" href="{% url 'app:select' %}"><i
                                class="icon icon-plus-circle"></i> 车票</a>
                    </li>
                    <li>
                        <a class="nav-link  active" href="{% url 'app:buy' %}"><i class="icon icon-trash-can"></i>购买</a>
                    </li>
                </ul>
            </div>
        </header>
        <div class="container-fluid relative animatedParent animateOnce">
            <div class="tab-content pb-3" id="v-pills-tabContent">

                <!--信息查询 Start-->
                <div class="tab-pane animated fadeInUpShort show active" id="v-pills-1">
                    <div class="container-fluid my-3">
                        <div class="d-flex row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div>
                                        <div class="card-body b-b">
                                            <h5>列车信息</h5>
                                        </div>
                                        <div class="card-body b-b">
                                            <div class="card-title">列车编号 / 车牌号</div>
                                            <h5>{{ bus.num }} / {{ bus.bus_num }}</h5>
                                        </div>
                                        <div class="card-body b-b">
                                            <div class="card-title"> 出发</div>
                                            <h5>{{ bus.start_time }}
                                                <span>&nbsp;&nbsp;&nbsp;&nbsp;{{ bus.start_station }}</span></h5>
                                            <div class="card-title"> 到达</div>

                                            <h5>{{ bus.end_time }}
                                                <span>&nbsp;&nbsp;&nbsp;&nbsp;{{ bus.end_station }}</span></h5>
                                        </div>
                                        <div class="card-body b-b">
                                            <div class="card-title">票务情况</div>
                                            <h5><strong><span id="stand"></span></strong>
                                                / {{ bus.ticket }}</h5>
                                        </div>
                                        <div class="card-body b-b">
                                            <h4>常用联系人</h4>
                                        </div>

                                        <div class="card-body b-b" id="a{{ foo.uid }}">
                                            <table class="table table-hover earning-box" style="margin: 0 auto ">
                                                <tr class="no-b">
                                                    <th class="w-1"><span id="c{{ foo.uid }}"></span></th>
                                                    <th class="w-25">用户名</th>
                                                    <th class="w-45">移动电话</th>
                                                    <th class="w-28"></th>
                                                </tr>
                                                {% for foo in foos %}
                                                    <tr class="no-b">
                                                        <td><span id="c{{ foo.uid }}"></span></td>
                                                        <td class="w-25">{{ foo.username }}</td>
                                                        <td class="w-45">{{ foo.phone }}</td>
                                                        <td class="w-28">
                                                            <button class="btn btn-primary btn" id="b{{ foo.uid }}">添加
                                                            </button>
                                                        </td>
                                                    </tr>

                                                    <script>
                                                        window.onload = function () {
                                                            document.getElementById('stand').innerText = {{ suu }};
                                                        };

                                                        $('#b{{ foo.uid }}').click(function () {
                                                            var o = $('#stand').text();
                                                            console.log(o);

                                                            function isInArray(arr, value) {
                                                                for (var i = 0; i < arr.length; i++) {
                                                                    if (value === arr[i]) {
                                                                        return false;
                                                                    }
                                                                }
                                                                return true;
                                                            }

                                                            var gu = $('#ooooo div');
                                                            gu_id = [];
                                                            for (var i = 0; i < gu.length; i++) {
                                                                gu_id.push(eval($(gu[i]).attr('id')));
                                                            }
                                                            console.log(gu_id,'===');
                                                            var p = {{ foo.uid }};
                                                            console.log(p)
                                                            if (o > 0 && isInArray(gu_id,p)===true) {
                                                                {#$(this).attr('disabled', 1);#}
                                                                $('#ooooo').append("<div class=\"card-body b-b\" onclick=\"ffo(this)\"  id=\"{{ foo.uid }}\"><h5>" + '{{ foo.username }}' + "</h5>" +
                                                                    "<button class=\"btn btn-primary btn\" id=\"so{{ foo.uid }}\">撤回\n" +
                                                                    "</button>" + "</div>");
                                                                o = o - 1;
                                                                console.log(o);
                                                                document.getElementById('stand').innerText = o;
                                                            }
                                                        });

                                                        function ffo(that) {
                                                            console.log('000');
                                                            $(that).remove();
                                                            var o = $('#stand').text();
                                                            console.log(o);
                                                            o = eval(o) + 1;
                                                            document.getElementById('stand').innerText = o;
                                                        }
                                                    </script>

                                                {% endfor %}
                                            </table>
                                        </div>
                                    </div>


                                    <div class="card-body b-b">
                                        <h5>牛皮王</h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div>
                                        <div class="card-body b-b">
                                            <h5>订单列表</h5>
                                        </div>
                                        <div class="card-body b-b">
                                            <h5> 所有订票如下：</h5>
                                        </div>
                                        <div id="ooooo">

                                        </div>

                                        <div class="card-body b-b">
                                            <a id="ppp" href=""><input class="btn btn-success btn-lg btn-sm" value="购买"
                                                                       type="submit" id="ooo" onclick="f()"> </a>
                                            <input class="btn btn-success btn-lg btn-sm" value="加入订单" type="submit"
                                                   id="ooo"
                                                   onclick="fo()">
                                            <script>
                                                function f() {
                                                    $(this).attr('disabled', 1);

                                                    var gu = $('#ooooo div');
                                                    gu_id = [];
                                                    for (var i = 0; i < gu.length; i++) {
                                                        gu_id.push($(gu[i]).attr('id'));
                                                    }
                                                    var o = {{ bus.price }};
                                                    var price = o * gu_id.length;
                                                    console.log(gu_id);
                                                    if (gu_id.length > 0) {
                                                        document.getElementById('ppp').href = '{% url 'app:payment' %}?uu=' + gu_id + '&bid={{ bid }}&user={{ uid }}&price=' + price;
                                                    }

                                                    $.ajax({
                                                        url:{% url 'app:payment' %},
                                                        type: 'GET',
                                                        data: {
                                                            'id': gu_id,
                                                            "price": price,
                                                            "user":{{ uid }},
                                                            "bid":{{ bid }}
                                                        },

                                                        success: function (data) {

                                                        }
                                                    })
                                                }

                                                function fo() {
                                                    {#$(this).attr('disabled', 1);#}
                                                    var gu = $('#ooooo div');
                                                    gu_id = [];
                                                    for (var i = 0; i < gu.length; i++) {
                                                        gu_id.push($(gu[i]).attr('id'));
                                                    }
                                                    console.log(gu_id);
                                                    bj = 'a';
                                                    for (var j = 0; j < gu_id.length; j++) {
                                                        bj = bj + ',' + gu_id[j]
                                                    }
                                                    var o = {{ bus.price }};
                                                    var price = o * gu_id.length;
                                                    $.ajax({
                                                        url:{% url 'app:add_payment' %},
                                                        type: 'GET',
                                                        data: {
                                                            "id": bj,
                                                            "price": price,
                                                            "user":{{ uid }},
                                                            "bid":{{ bid }}
                                                        },

                                                    })
                                                }
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!--信息查询 End-->

        </div>
    </div>
    </div>

    <script>
        {#var u = $('#usero').val();#}

        function d() {
            var u = $('#usero').val();
            var ao = $('#{{ foo }}')
            console.log(u);
            $.ajax({
                url:{% url 'app:buy' %},
                type: 'GET',
                data: {'KKK': u},
                success: function (data) {
                }
            })
        }


        console.log('lll');
        $("#{{ foo.uid }}").click(function () {
            console.log('ooo');
            var a = $('#usero').val();
            var b = $('#bianhao').val();
            var c = $('#jiage').val();
            var d = $('#idnum').val();
            var e = $('#phone').val();
            if (a) {
                $.ajax({
                    url:{% url 'app:payment' %},
                    type: 'get',
                    data: {'KKK': uid},
                    success: function (data) {

                    }
                });
                {#$("#ppp").append("<tr id=''><td>'+a+'</td><td>'+d+'</td><td>'+b+'</td><td>'+c+'</td></tr>")#}
            }
        });

    </script>

{% endblock %}



<!-- 内容结束 -->

